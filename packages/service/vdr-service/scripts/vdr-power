#!/bin/sh

# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (C) 2016-present Team LibreELEC (https://libreelec.tv)

. /etc/profile

CONFIG_CACHE="/storage/.cache"
VDR_HOME="$HOME/.config/vdr"

systemctl stop vdr-front.service

# dvb
if [ -f $CONFIG_CACHE/services/dvb.conf ]; then
  . $CONFIG_CACHE/services/dvb.conf

  for module in $DVB_REMOVE_MODULES ; do
    rmmod $module
  done
fi

# post
if [ -f $VDR_HOME/scripts.conf ]; then
  . $VDR_HOME/scripts.conf

  vdr_post
fi

case "$1" in
  -p) # poweroff
    poweroff -f
  ;;
  -r) # reboot
    reboot
  ;;
  -s) # sleep
    pm-suspend suspend
  ;;
  -e) # exit to XBMC

    if [ -f $CONFIG_CACHE/services/vdr.conf ]; then
      systemctl start vdr.service
    fi

    if [ -f $CONFIG_CACHE/services/tvheadend.conf ]; then
      systemctl start tvheadend.service
    fi

    sleep 4

    systemctl start kodi.service
  ;;
esac
