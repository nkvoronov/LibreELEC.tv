#!/bin/sh

# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2018-present Team LibreELEC (https://libreelec.tv)

. /etc/profile

oe_setup_addon service.vdr24

VDR_FRONT_RUN_FILE="$ADDON_HOME/vdr-front.run"
VDR_RUN_FILE="$ADDON_HOME/vdr.enable"

if [ -f "$VDR_FRONT_RUN_FILE" ]; then

    echo "Stop VDR ..."

    rm -f $VDR_FRONT_RUN_FILE

    case "$1" in
        -p) # poweroff
            poweroff -f
        ;;
        -r) # reboot
            reboot
        ;;
        -s) # sleep
            pm-suspend suspend
        ;;
        -e) # exit to XBMC

            if systemctl is-enabled service.tvheadend43.service &>/dev/null ; then
                systemctl start service.tvheadend43.service
            fi

            sleep 4

            systemctl restart kodi.service
        ;;
    esac
fi